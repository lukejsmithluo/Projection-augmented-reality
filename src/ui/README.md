# 用户界面（ui）

此目录包含 PyQt6 应用入口与基础窗口：
- `app.py`：主窗口，包含“空间映射”、“投影标定”、“AI图像生成”标签页。

运行示例：
```powershell
python .\src\ui\app.py
```

使用说明：
- 先启动后端 API 服务：`python -m uvicorn src.server.main:app --reload`。
- UI 按钮通过 HTTP 调用后端端点：
  - “开始映射/停止映射”分别对应 `POST /mapping/start` 与 `POST /mapping/stop`；
  - “开始标定”对应 `POST /calibration/run`；状态信息将在标签页标题处更新。
  - “AI图像生成”上传图片与提示词，调用 `POST /ai-image/edit`，输出路径显示在状态区域；需在 `.env` 配置 `OPENAI_API_KEY`。
  - 生成成功后 UI 内直接预览图片，并提供“打开输出目录”按钮快捷查看生成结果文件。
  - 支持“预览最新输出”，无需再次生成，直接显示 `data/ai_images/outputs` 中最近的图片。
  - 支持多图选择并在界面中进行右到左缩略图排布；生成默认使用最近一次选择的图片。
  - 缩略图预览置于 16:9 框中（约 640x360），一次最多可见 3 张，更多图片可通过横向滑条浏览；顺序为左→右：最早在左、最新在右；提供“清空已选图片”按钮。
  - 生成界面新增 OpenAI API Key 输入框（默认以 * 隐藏，右侧按钮可切换显示）；当填写时会随请求一并传递到后端以便即时使用。

窗口尺寸：默认 `1280x720`（16:9）。

更新记录：
- 2025-11-19：新增“AI图像生成”标签页，支持上传图片与提示词并生成输出。
 - 2025-11-19：AI 图像生成标签页增加内嵌预览、打开输出目录与“预览最新输出”功能。
 - 2025-11-19：UI 支持多图选择与右到左缩略图预览；默认窗口为 1280x720。
 - 2025-11-19：AI 标签页缩略图容器改为 16:9 框（最多显示 3 张，超出可横向滑动）；新增“清空已选图片”。新增 API Key 输入与显示/隐藏切换。缩略图顺序修正为左→右（最早→最新）。
- 2025-11-19：风格维护（imports 排序与格式统一），修复 CI isort/black 提示；不改动业务逻辑。
- 2025-11-05：启用风格检查（ruff/black/isort）；本目录 Python 文件已按规则格式化，未改变业务逻辑。
- 2025-11-05：UI 按钮已接入后端 HTTP 端点，需先启动 API 服务。